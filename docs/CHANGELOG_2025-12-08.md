# –û—Ç—á—ë—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö - 8 –¥–µ–∫–∞–±—Ä—è 2025 –≥.

## üìã –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ª–∏—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–ª–Ω—ã–º –∞—É–¥–∏—Ç–æ–º –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

---

## üóÑÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–æ–Ω–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `image_library`

**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `/var/www/FOHOW-proekt-v3/api/migrations/025_add_image_placeholders.sql`

```
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
ALTER TABLE image_library ADD COLUMN IF NOT EXISTS preview_placeholder TEXT;
ALTER TABLE image_library ADD COLUMN IF NOT EXISTS blurhash TEXT;
```

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:**
- `preview_placeholder` - base64 placeholder –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–≤—å—é
- `blurhash` - –∫–æ–º–ø–∞–∫—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–º—ã—Ç–æ–≥–æ placeholder

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:**
```
sudo -u postgres psql -d fohow -c "ALTER TABLE image_library ADD COLUMN IF NOT EXISTS preview_placeholder TEXT;"
sudo -u postgres psql -d fohow -c "ALTER TABLE image_library ADD COLUMN IF NOT EXISTS blurhash TEXT;"
```

---

### 2. –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –∞—É–¥–∏—Ç–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π `image_rename_audit`

**–§–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:** `/var/www/FOHOW-proekt-v3/api/migrations/026_add_image_rename_audit.sql`

```
-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∞—É–¥–∏—Ç–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
-- –í–µ—Ä—Å–∏—è: 026

DO $$
BEGIN
  IF NOT EXISTS (
    SELECT 1
    FROM information_schema.tables
    WHERE table_name = 'image_rename_audit'
  ) THEN
    CREATE TABLE image_rename_audit (
      id BIGSERIAL PRIMARY KEY,
      image_id BIGINT NOT NULL,
      user_id BIGINT NOT NULL,
      old_name TEXT NOT NULL,
      new_name TEXT NOT NULL,
      folder_name TEXT,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      CONSTRAINT fk_image_rename_audit_image FOREIGN KEY (image_id) REFERENCES image_library (id) ON DELETE CASCADE,
      CONSTRAINT fk_image_rename_audit_user FOREIGN KEY (user_id) REFERENCES users (id) ON DELETE CASCADE
    );

    COMMENT ON TABLE image_rename_audit IS '–ê—É–¥–∏—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
    COMMENT ON COLUMN image_rename_audit.folder_name IS '–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏–ª–æ—Å—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';
  END IF;
END $$;
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã:**
- `id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏—Ç–∞
- `image_id` - ID –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (FK –Ω–∞ image_library)
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª (FK –Ω–∞ users)
- `old_name` - —Å—Ç–∞—Ä–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
- `new_name` - –Ω–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
- `folder_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏–ª–æ—Å—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- `created_at` - timestamp –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

**–ü—Ä–∏–º–µ–Ω–µ–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π:**
```
sudo -u postgres psql -d fohow -f /var/www/FOHOW-proekt-v3/api/migrations/026_add_image_rename_audit.sql
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Backend (API)

### –§–∞–π–ª: `/var/www/FOHOW-proekt-v3/api/routes/images.js`

**–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π endpoint:**

```
/**
 * PATCH /api/images/:id/rename - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ª–∏—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
 */
app.patch(
  '/api/images/:id/rename',
  {
    preHandler: [authenticateToken]
  },
  async (req, reply) => { ... }
);
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å endpoint'–∞:**

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏–º—è –Ω–µ –ø—É—Å—Ç–æ–µ
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏ (–º–∞–∫—Å 200 —Å–∏–º–≤–æ–ª–æ–≤)

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã:**
   - SQL –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ —Å —Ç–∞–∫–∏–º –∂–µ –∏–º–µ–Ω–µ–º –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç type casting `$4::text` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å NULL

4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω–∏:**
   - UPDATE –≤ —Ç–∞–±–ª–∏—Ü–µ `image_library`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è `updated_at`

5. **–ó–∞–ø–∏—Å—å –≤ –∞—É–¥–∏—Ç:**
   - INSERT –≤ —Ç–∞–±–ª–∏—Ü—É `image_rename_audit`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ –∏–º–µ–Ω–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–∞–ø–∫–∏

**–ö–æ–¥—ã –æ—à–∏–±–æ–∫:**
- `INVALID_INPUT` (400) - –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `NOT_FOUND` (404) - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
- `FORBIDDEN` (403) - –Ω–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- `SHARED_IMAGE` (403) - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ
- `DUPLICATE_NAME` (409) - —Ñ–∞–π–ª —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `SERVER_ERROR` (500) - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–µ:** —Å—Ç—Ä–æ–∫–∏ ~1244-1385

---

## üíª –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ Frontend

### 1. –§–∞–π–ª: `/var/www/FOHOW-proekt-v3/src/services/imageService.js`

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è:**

```
/**
 * –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
 * @param {number} imageId - ID –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * @param {string} newName - –ù–æ–≤–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
 * @returns {Promise<Object>}
 */
export async function renameImage(imageId, newName) {
  try {
    const response = await fetch(`${API_URL}/images/${imageId}/rename`, {
      method: 'PATCH',
      headers: {
        ...getAuthHeaders(),
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ new_name: newName })
    });

    if (!response.ok) {
      await handleErrorResponse(response, '–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
    }

    return await response.json();
  } catch (error) {
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
      const networkError = new Error('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
      networkError.code = 'NETWORK_ERROR';
      throw networkError;
    }
    throw error;
  }
}
```

---

### 2. –§–∞–π–ª: `/var/www/FOHOW-proekt-v3/src/components/Images/ImageCard.vue`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–í `<script setup>`:**
   - –î–æ–±–∞–≤–ª–µ–Ω emit —Å–æ–±—ã—Ç–∏—è `'rename'` –≤ —Å–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleRename(e)` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ

2. **–í `<template>`:**
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Å –∏–∫–æ–Ω–∫–æ–π –∫–∞—Ä–∞–Ω–¥–∞—à–∞:

```
<button
  type="button"
  class="image-card__action image-card__action--rename"
  title="–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å"
  @click="handleRename"
>
  <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" fill="currentColor"/>
  </svg>
</button>
```

3. **–í `<style scoped>`:**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –∫–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –±–ª–æ–∫ `.image-card__actions-row--bottom`, –ø–µ—Ä–µ–¥ –∫–Ω–æ–ø–∫–æ–π —É–¥–∞–ª–µ–Ω–∏—è

---

### 3. –§–∞–π–ª: `/var/www/FOHOW-proekt-v3/src/components/Images/MyLibraryTab.vue`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **–í `<script setup>`:**
   - –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç: `import { renameImage } from '../../services/imageService'`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleRename(image)`:

```
async function handleRename(image) {
  const currentName = image.original_name.replace(/\.[^/.]+$/, ''); // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
  const newName = prompt(`–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:`, currentName);

  if (!newName || newName.trim() === '') {
    return;
  }

  if (newName.trim() === currentName) {
    notificationsStore.addNotification({
      message: '–ò–º—è –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å',
      type: 'info',
      duration: 3000
    });
    return;
  }

  try {
    await renameImage(image.id, newName.trim());

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
    const index = images.value.findIndex(img => img.id === image.id);
    if (index !== -1) {
      const extension = image.original_name.match(/\.[^/.]+$/)?. || '.webp';
      images.value[index] = {
        ...images.value[index],
        original_name: newName.trim() + extension
      };
    }

    notificationsStore.addNotification({
      message: `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –≤ "${newName}"`,
      type: 'success',
      duration: 4000
    });

    console.log('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ:', image.id);
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);

    notificationsStore.addNotification({
      message: `–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è: ${error.message}`,
      type: 'error',
      duration: 6000
    });
  }
}
```

2. **–í `<template>`:**
   - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è `@rename="handleRename"` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `<ImageCard>`

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ 500  
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∫–æ–ª–æ–Ω–∫–∏ `preview_placeholder` –∏ `blurhash` –≤ —Ç–∞–±–ª–∏—Ü–µ `image_library`  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é 025

### –ü—Ä–æ–±–ª–µ–º–∞ 2: SQL –æ—à–∏–±–∫–∞ "could not determine data type of parameter $4"
**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ PostgreSQL  
**–ü—Ä–∏—á–∏–Ω–∞:** PostgreSQL –Ω–µ –º–æ–≥ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –≤ —É—Å–ª–æ–≤–∏–∏ `(folder_name IS NULL AND $4 IS NULL)`  
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —è–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞: `$4::text IS NULL`

---

## üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:

```
# –ú–∏–≥—Ä–∞—Ü–∏—è 025 - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è placeholder
sudo -u postgres psql -d fohow -f /var/www/FOHOW-proekt-v3/api/migrations/025_add_image_placeholders.sql

# –ú–∏–≥—Ä–∞—Ü–∏—è 026 - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –∞—É–¥–∏—Ç–∞
sudo -u postgres psql -d fohow -f /var/www/FOHOW-proekt-v3/api/migrations/026_add_image_rename_audit.sql
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã:

```
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ image_library
sudo -u postgres psql -d fohow -c "\d image_library"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –∞—É–¥–∏—Ç–∞
sudo -u postgres psql -d fohow -c "\d image_rename_audit"
```

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å API:

```
systemctl restart fohow-api
systemctl status fohow-api
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è:

1. –û—Ç–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è" ‚Üí "–ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞"
2. –ù–∞–≤–µ—Å—Ç–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –ù–∞–∂–∞—Ç—å –Ω–∞ –∏–∫–æ–Ω–∫—É –∫–∞—Ä–∞–Ω–¥–∞—à–∞
4. –í–≤–µ—Å—Ç–∏ –Ω–æ–≤–æ–µ –∏–º—è
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É–¥–∏—Ç–∞:

```
sudo -u postgres psql -d fohow -c "SELECT * FROM image_rename_audit ORDER BY created_at DESC LIMIT 5;"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π:

1. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å –∏–º–µ–Ω–µ–º, –∫–æ—Ç–æ—Ä–æ–µ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–æ–π –∂–µ –ø–∞–ø–∫–µ
2. –î–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞: "–§–∞–π–ª —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ"

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 5
  - `api/routes/images.js` (backend)
  - `src/services/imageService.js` (frontend)
  - `src/components/Images/ImageCard.vue` (frontend)
  - `src/components/Images/MyLibraryTab.vue` (frontend)
  - 2 —Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

- **–¢–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω–æ:** 1 (`image_rename_audit`)
- **–ö–æ–ª–æ–Ω–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 2 (`preview_placeholder`, `blurhash`)
- **API endpoints –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 1 (`PATCH /api/images/:id/rename`)
- **–§—É–Ω–∫—Ü–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ:** 2 (backend + frontend)

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `authenticateToken`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ó–∞–ø—Ä–µ—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –æ–±—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω—ã –∏–º–µ–Ω–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è)
- ‚úÖ SQL injection –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ Type casting –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è SQL –æ—à–∏–±–æ–∫

---

## üìÖ –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–î–∞—Ç–∞:** 8 –¥–µ–∫–∞–±—Ä—è 2025 –≥.  
**–í—Ä–µ–º—è:** 22:40 UTC+5  
**–ê–≤—Ç–æ—Ä:** –°–µ—Ä–≥–µ–π (sergeyxmao)  
**–í–µ—Ä—Å–∏—è:** 1.0.0

---

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –î–æ–±–∞–≤–∏—Ç—å batch –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ —Å—Ä–∞–∑—É)
2. –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–π –≤ UI –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–∞—Ç–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (undo)
4. –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω—É–º–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ –¥—É–±–ª—è—Ö (file.jpg ‚Üí file-1.jpg)
5. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∞—Ö —Ñ–∞–π–ª–æ–≤

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á—ë—Ç–∞**
