# План по настройке и отображению тарифов

## 1. Источник правды по тарифам
- Бэкенд отдаёт тарифы через эндпоинт `/api/plans`; фронтенд подхватывает их и дополняет демо-планом, если его нет в ответе API, чтобы карточки всегда рендерились. Это логика страницы тарифов `src/views/PricingPage.vue` (загрузка планов, добавление демо-плана). 
- Основные поля, которые уже используются карточками: `name`, `description`, `price_monthly`, `code_name`, `is_featured` и объект `features` с фичами/лимитами.

## 2. Что видит пользователь
- Публичная страница `/pricing` показывает карточки тарифов с названием, описанием, ценой (помесячно или за 3 месяца со скидкой), бейджами «Рекомендуем»/«Текущий план» и перечнем функций из набора `importantFeatures`. Сейчас в списке нет лимитов медиатеки, поэтому доступ к библиотеке изображений и лимиты по файлам/папкам/объёму не отображаются.
- При авторизации страница помечает текущий тариф, подгружая план пользователя через `subscriptionStore.loadPlan()`. Это позволяет подсветить активный план и скрыть кнопку выбора.
- В пользовательских фичах и лимитах действует правило: если `can_use_images` отсутствует, всем планам, кроме `guest`, доступ к библиотеке разрешён. Лимиты по ресурсам (`max_boards`, `max_notes`, `max_stickers`, `max_comments`, `max_licenses`) формируются в сторе подписки и используются компонентами для блокировок/уведомлений.

## 3. Что делает администратор
- В админке (компонент `AdminUsers`) доступна смена роли и тарифа пользователя через модальное окно: админ выбирает план из списка, задаёт длительность (дни) и сохраняет. План и его срок действия обновляются через бэкенд-эндпоинт `PATCH /api/admin/users/:userId/plan`, который также снимает блокировки с досок и пишет историю подписок.
- При загрузке админки список тарифов берётся через `subscriptionStore.fetchPlans()`, поэтому любые новые планы или изменения в БД сразу появляются в выпадающем списке смены тарифа.

## 4. Рекомендованный порядок доработок
1. **Расширить отображаемые фичи на `/pricing`**: добавить в `importantFeatures` и маппинг `featureLabels` показатели медиатеки (`can_use_images`, `max_images`, `max_image_folders`, `max_image_storage_mb`), чтобы пользователи видели лимиты библиотеки. 
2. **Синхронизировать тексты тарифов**: хранить описания/лейблы фич в одном месте (конфигурация на бэкенде или общий словарь), чтобы карточки, письма и админка показывали одинаковые названия и лимиты.
3. **Развести права админа и пользователя**: оставить администратору возможность менять тарифы и длительность через `/api/admin/users/:userId/plan`, а в пользовательских карточках показывать только доступные действия (купить/перейти), без опасных кнопок.
4. **Контроль лимитов в интерфейсе**: продолжать использовать `subscriptionStore.checkFeature` и `checkLimit` для блокировок и подсказок. Если добавлять новые лимиты (медиатека, AI и т.п.), дописывать их в стор и компоненты, чтобы предупреждения были единообразными.
5. **Прозрачность блокировок**: при автоматическом переводе на гостевой или при истечении тарифа показывать пользователю уведомление с указанием, какой лимит сработал и какой план его снимет; админка уже снимает блокировки досок при продлении, поэтому важно, чтобы пользователь видел это заранее.

## 5. Как проверить корректность после изменений
- Зайти на `/pricing` без авторизации и убедиться, что все тарифы и их фичи отображаются, включая медиатеку и новые лимиты.
- Авторизоваться под обычным пользователем и проверить подсветку текущего плана и скрытие кнопки выбора.
- В админке сменить тариф пользователю и убедиться, что дата окончания подписки пересчиталась, а заблокированные доски разблокировались.
- Создать/загрузить контент (доски, изображения) и убедиться, что `checkFeature`/`checkLimit` корректно разрешают/блокируют действия согласно новому тарифу.
