# Board Partners API

## Описание

API для получения списка партнёров на доске. Используется в панели "Обсуждения → Партнёры" для отображения информации о партнёрах, размещённых на доске.

## Расположение

`api/routes/boardPartners.js`

## Эндпоинты

### GET /api/boards/:boardId/partners

Получение списка партнёров по карточкам типа `large` и `gold`.

**Параметры:**
- `boardId` (path) — ID доски
- `search` (query, optional) — поисковый запрос для фильтрации партнёров

**Логика работы:**
1. Проверяет, что доска существует и принадлежит текущему пользователю
2. Извлекает карточки типа `large` и `gold` из контента доски
3. Получает `personal_id` из текста карточек
4. Возвращает данные верифицированных пользователей с совпадающими `personal_id`

**Ответ:**
```json
{
  "success": true,
  "partners": [
    {
      "id": 123,
      "username": "partner_name",
      "personal_id": "RUY123456789",
      "avatar_url": "/api/avatars/123/avatar.png",
      "full_name": "Имя Партнёра",
      "phone": "+7...",
      "city": "Москва",
      "country": "Россия",
      "office": "Офис",
      "telegram_user": "@username",
      "instagram_profile": "@instagram",
      "vk_profile": "vk.com/...",
      "website": "https://..."
    }
  ]
}
```

### GET /api/boards/:boardId/avatar-partners

Получение списка партнёров по аватар-карточкам.

**Параметры:**
- `boardId` (path) — ID доски
- `search` (query, optional) — поисковый запрос для фильтрации партнёров

**Логика работы:**
1. Проверяет, что доска существует и принадлежит текущему пользователю
2. Извлекает карточки типа `avatar` с привязанным `userId`
3. Возвращает данные верифицированных пользователей

**Ответ:**
```json
{
  "success": true,
  "partners": [
    {
      "id": 123,
      "avatarObjectId": "avatar-uuid",
      "userId": 123,
      "username": "partner_name",
      "full_name": "Имя Партнёра",
      "avatar_url": "/api/avatars/123/avatar.png",
      "x": 100,
      "y": 200,
      "diameter": 50
    }
  ]
}
```

## Фильтрация

Оба эндпоинта применяют следующую фильтрацию:

- **Верификация:** только пользователи с `is_verified = true`
- **Настройки видимости:** поля возвращаются согласно `visibility_settings` пользователя
- **Настройки поиска:** при использовании параметра `search` учитываются `search_settings` пользователя

## Аутентификация

Требуется JWT-токен в заголовке `Authorization: Bearer <token>`.

## История изменений

| Дата | Изменение |
|------|-----------|
| 2025-02-03 | Убрано ограничение по тарифам (`plan_id IN (6, 7)`). Теперь все верифицированные пользователи отображаются в списке партнёров независимо от тарифного плана. |
