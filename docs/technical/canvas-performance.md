# Оптимизация производительности холста

## Описание
CSS-оптимизации для плавного панорамирования и зуммирования при большом количестве карточек (90+).

## Расположение файлов
- Основной файл: `src/components/Canvas/CanvasBoard.vue` (секция `<style>`)
- Связанные файлы: `src/components/Canvas/Card.vue` (секция `<style>`), `src/composables/usePanZoom.js`

## Применённые оптимизации

### 1. GPU Compositor Layer
- Свойство: `will-change: transform` + `backface-visibility: hidden` на `.canvas-content`
- Эффект: Вынос всего содержимого холста в отдельный GPU-слой. Браузер сдвигает текстуру GPU без пересчёта layout/paint для каждого из ~90 дочерних элементов
- Ожидаемое ускорение: 50-70%

### 2. CSS Containment на карточках
- Свойство: `contain: layout style paint` на `.card`
- Эффект: Изоляция каждой карточки — изменения внутри одной карточки не вызывают перерасчёт layout/style/paint у соседних
- Ожидаемое ускорение: 15-20%

### 3. CSS Containment на SVG-слое
- Свойство: `contain: strict` на `.svg-layer`
- Эффект: SVG-слой с линиями изолирован от DOM карточек — reflow в SVG не затрагивает карточки и наоборот

### 4. Уменьшение области сетки
- Свойство: `inset: -2000px` вместо `-5000px` на `.canvas-content::before`
- Эффект: Уменьшение площади paint фоновой сетки с ~10000x10000px до ~4000x4000px
- Ожидаемое ускорение: 5-10%

### 5. Отключение pointer-events при панорамировании
- Селектор: `.canvas-container--panning .card, .sticker, .canvas-image, .line-group`
- Эффект: Браузер пропускает hit-testing для всех ~90+ карточек при каждом pointermove
- CSS-класс `canvas-container--panning` управляется из `usePanZoom.js`
- Ожидаемое ускорение: 5-10%

### 6. Отключение CSS-эффектов при панорамировании
- Селектор: `.canvas-container--panning .line`
- Свойства: `transition: none !important; filter: none !important;`
- Эффект: Убираются `drop-shadow` и `transition` на ~90+ линиях при движении

## Технические детали
- Все оптимизации — только CSS, JS не затронут
- CSS-класс `canvas-container--panning` уже управлялся из `usePanZoom.js` (строка 11: `PAN_CURSOR_CLASS`)
- При завершении панорамирования все эффекты (тени, transition) автоматически восстанавливаются

## Как тестировать
1. Загрузить доску с 90+ карточками и линиями-соединениями
2. Зажать среднюю кнопку мыши (колёсико) и двигать холст
3. Убедиться что панорамирование плавное
4. Отпустить кнопку — убедиться что тени на линиях вернулись
5. Кликнуть по карточке — убедиться что выделение работает
6. Перетащить карточку — убедиться что drag работает
7. Протестировать zoom (колёсико вверх/вниз)
8. Протестировать на мобильном: двупальцевое перемещение и пинч-зум
9. Проверить что фоновая сетка (если включена) отображается корректно при удалении от центра

## Возможные дальнейшие оптимизации (Этап 2)
- Виртуализация карточек — рендерить только видимые в viewport
- Троттлинг `syncAllNoteWindows()` при панорамировании
- LOD (Level of Detail) — упрощённый рендер при zoom < 30%
- `v-memo` на компонентах Card/UserCard

## История изменений
- 2026-02-14: Этап 1 — CSS-оптимизации (GPU layer, containment, pointer-events, grid area)
