# HeaderActions

Компонент панели быстрых действий в заголовке приложения для добавления карточек и переключения темы.

## Расположение

```
src/components/Layout/HeaderActions.vue
```

## Описание

`HeaderActions` предоставляет пользователям быстрый доступ к основным действиям:
- Добавление различных типов лицензий (стандартная, большая, Gold)
- Добавление карточки партнёра (только для администраторов)
- Вставка шаблонов из библиотеки
- Переключение темы интерфейса

Компонент поддерживает два варианта отображения:
- `default` - горизонтальная компоновка
- `menu` - вертикальная компоновка в виде сетки 2×3

## Props

| Prop | Тип | По умолчанию | Описание |
|------|-----|--------------|----------|
| `isModernTheme` | `Boolean` | `false` | Флаг темной темы интерфейса |
| `hideThemeToggle` | `Boolean` | `false` | Скрывает кнопку переключения темы |
| `variant` | `String` | `'default'` | Вариант отображения: `'default'` или `'menu'` |

## Events

| Event | Payload | Описание |
|-------|---------|----------|
| `toggle-theme` | - | Срабатывает при клике на кнопку переключения темы |

## Stores

Компонент использует следующие хранилища:

- **`useAuthStore`** - для проверки роли пользователя (доступ к кнопке партнёра)
- **`useCardsStore`** - для создания новых карточек
- **`useConnectionsStore`** - для создания связей при вставке шаблонов
- **`useViewSettingsStore`** - для получения настроек отображения (цвета, толщина линий, анимация)

## Функциональность

### Добавление карточек

#### Лицензии

- **Стандартная лицензия** (`□`) - добавляет карточку типа `small`
- **Большая лицензия** (`⧠`) - добавляет карточку типа `large`
- **Gold лицензия** (`★`) - добавляет карточку типа `gold`

Все типы лицензий проверяют лимит карточек через `checkAndAlertCardLimit()` перед добавлением.

#### Карточка партнёра

- **Кнопка с аватаром** - добавляет карточку пользователя (партнёра)
- **Ограничение доступа**: кнопка видна только пользователям с ролью `admin`
- **Проверка роли**: `authStore.user?.role === 'admin'`

### Шаблоны

Компонент поддерживает загрузку и вставку шаблонов из директории `/src/templates/*.json`.

**Структура шаблона:**
```json
{
  "meta": {
    "title": "Название шаблона"
  },
  "cards": [
    {
      "key": "card1",
      "type": "large",
      // другие свойства карточки
    }
  ],
  "connections": [
    {
      "startKey": "card1",
      "endKey": "card2",
      "color": "#0f62fe",
      "thickness": 2,
      "startSide": "bottom",
      "endSide": "top",
      "animationDurationMs": 1000
    }
  ]
}
```

**Особенности вставки шаблонов:**
1. Проверка лимита карточек перед вставкой
2. Создание карточек с сохранением внутренних связей
3. Применение текущих настроек цвета заголовков
4. Автоматическое выделение вставленных карточек
5. Создание связей между карточками согласно шаблону

### Переключение темы

Кнопка переключения темы может быть скрыта через prop `hideThemeToggle`.

## Права доступа

| Функция | Роль | Условие |
|---------|------|---------|
| Добавление лицензий (□, ⧠, ★) | Все авторизованные | - |
| Добавление шаблонов (⧉) | Все авторизованные | - |
| Добавление карточки партнёра | Только администраторы | `authStore.user?.role === 'admin'` |
| Переключение темы | Все авторизованные | `!hideThemeToggle` |

## Стили

Компонент использует CSS-переменные для поддержки светлой и темной тем:

```css
--header-button-bg         /* Фон кнопок */
--header-button-border     /* Цвет границы */
--header-button-color      /* Цвет текста */
--header-button-shadow     /* Тень кнопки */
--header-button-hover-shadow /* Тень при наведении */
```

### Варианты отображения

- **Default** - горизонтальная панель с кнопками 44×44px
- **Menu** - сетка 2×2 с кнопками 60×60px

## Примеры использования

### Базовое использование

```vue
<HeaderActions
  :is-modern-theme="isDarkMode"
  @toggle-theme="handleThemeToggle"
/>
```

### С вариантом menu

```vue
<HeaderActions
  variant="menu"
  :is-modern-theme="isDarkMode"
  :hide-theme-toggle="false"
  @toggle-theme="handleThemeToggle"
/>
```

### Без кнопки переключения темы

```vue
<HeaderActions
  :hide-theme-toggle="true"
/>
```

## Обработка ошибок

1. **Лимит карточек** - при превышении лимита отображается предупреждение через `checkAndAlertCardLimit()`
2. **Пустые шаблоны** - кнопка шаблонов становится неактивной, если нет доступных шаблонов
3. **Некорректные данные шаблона** - пропускаются карточки/связи с отсутствующими обязательными полями

## Доступность (A11y)

- Все кнопки имеют атрибут `title` с описанием действия
- Используется `visually-hidden` для текстовых описаний иконок
- Меню шаблонов имеет `role="menu"` и `aria-label`
- Кнопка шаблонов имеет `aria-haspopup` и `aria-expanded`
- Закрытие меню по клавише `Escape`

## Зависимости

- `useAuthStore` - проверка роли пользователя
- `useCardsStore` - управление карточками
- `useConnectionsStore` - управление связями
- `useViewSettingsStore` - настройки отображения
- `checkAndAlertCardLimit` - утилита проверки лимитов

## История изменений

### 2026-01-11
- Добавлено ограничение доступа к кнопке "Добавить карточку партнёра" только для администраторов
- Добавлен импорт и использование `useAuthStore` для проверки роли пользователя
- Добавлена проверка `v-if="authStore.user?.role === 'admin'"` на обе кнопки с аватаром (для вариантов `menu` и `default`)

## См. также

- [CardsStore](../../stores/cards.md)
- [ConnectionsStore](../../stores/connections.md)
- [ViewSettingsStore](../../stores/viewSettings.md)
- [AuthStore](../../stores/auth.md)
