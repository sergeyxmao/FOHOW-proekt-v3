# –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –û–ø–∏—Å–∞–Ω–∏–µ
–ú–æ–¥—É–ª—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∑–∞–≥—Ä—É–∂–∞—Ç—å, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤—ã–≤–∞—Ç—å
–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–æ—Å–∫–∞—Ö. –í–∫–ª—é—á–∞–µ—Ç –ª–∏—á–Ω—É—é –∏ –æ–±—â—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
### Backend
- API —Ä–æ—É—Ç—ã –ª–∏—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: api/routes/images/myLibrary.js
- API —Ä–æ—É—Ç—ã –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: api/routes/images/shared.js
- API —Ä–æ—É—Ç—ã –ø—Ä–æ–∫—Å–∏: api/routes/images/proxy.js
- API —Ä–æ—É—Ç—ã –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö: api/routes/images/favorites.js
- –ò–Ω–¥–µ–∫—Å–Ω—ã–π —Ñ–∞–π–ª: api/routes/images/index.js
- –°–µ—Ä–≤–∏—Å –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞: api/services/yandexDiskService.js
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞–ø–æ–∫: api/services/sharedFoldersSync.js

### Frontend
- –ü–∞–Ω–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: src/components/Panels/ImagesPanel.vue
- –í–∫–ª–∞–¥–∫–∞ "–ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞": src/components/Images/MyLibraryTab.vue
- –í–∫–ª–∞–¥–∫–∞ "–û–±—â–∞—è": src/components/Images/SharedLibraryTab.vue
- –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: src/components/Images/ImageCard.vue
- –í–∫–ª–∞–¥–∫–∞ "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ": src/components/Images/FavoritesTab.vue
- –í–∫–ª–∞–¥–∫–∞ "–ù–∞ –¥–æ—Å–∫–µ": src/components/Images/BoardImagesTab.vue
- –°–µ—Ä–≤–∏—Å API: src/services/imageService.js
- Composable –ø—Ä–æ–∫—Å–∏: src/composables/useImageProxy.js

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –õ–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- GET /api/images/my ‚Äî –°–ø–∏—Å–æ–∫ –ª–∏—á–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –ø–∞–ø–∫–µ)
- GET /api/images/my/folders ‚Äî –°–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ –ª–∏—á–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- POST /api/images/my/folders ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ (body: { folder_name: string })
- GET /api/images/my/stats ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- POST /api/images/upload ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (multipart/form-data: file ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, folder/width/height ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). Body schema –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚Äî multipart –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ req.file() –≤ handler
- DELETE /api/images/:id ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- PATCH /api/images/:id/rename ‚Äî –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- POST /api/images/:id/share-request ‚Äî –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é

### –û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- GET /api/images/shared ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–ø–∞–ø–∫–∏ + –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤ `folders`, –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `id`, `name` –∏ –º–∞—Å—Å–∏–≤ `images`. –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–∞–ø–∫–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–ø–∫–µ "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" (id: null).

### –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- GET /api/images/favorites ‚Äî –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (JOIN image_library)
- GET /api/images/favorite-ids ‚Äî –ú–∞—Å—Å–∏–≤ ID –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä–¥–µ—á–µ–∫)
- POST /api/images/:id/favorite ‚Äî –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ (ON CONFLICT DO NOTHING)
- DELETE /api/images/:id/favorite ‚Äî –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

### –ü—Ä–æ–∫—Å–∏
- GET /api/images/proxy/:id ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ (—Å–≤–µ–∂–∏–µ —Å—Å—ã–ª–∫–∏ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞)

## –ü–∞–Ω–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äî –≤–∫–ª–∞–¥–∫–∏

–ü–∞–Ω–µ–ª—å –∏–º–µ–µ—Ç 4 –≤–∫–ª–∞–¥–∫–∏ –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É: `[–õ–∏—á–Ω—ã–µ] [–û–±—â–∞—è] [‚ô•] [üñº]`

### –õ–∏—á–Ω—ã–µ (activeTab = 'my')
–õ–∏—á–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–∞–ø–∫–∏, –ø–æ–∏—Å–∫, –∑–∞–≥—Ä—É–∑–∫–∞, —É–¥–∞–ª–µ–Ω–∏–µ, –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ –æ–±—â—É—é. –ù–∞ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî —Å–µ—Ä–¥–µ—á–∫–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.

### –û–±—â–∞—è (activeTab = 'shared')
–û–±—â–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ). –ü–∞–ø–∫–∏, –ø–æ–∏—Å–∫. –ù–∞ –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî —Å–µ—Ä–¥–µ—á–∫–æ.

### –ò–∑–±—Ä–∞–Ω–Ω–æ–µ (activeTab = 'favorites')
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ —Å–µ—Ä–¥–µ—á–∫–æ–º. –¢–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ (–±–µ–∑ –ø–∞–ø–æ–∫). –ö–ª–∏–∫ ‚Äî placement mode. –°–µ—Ä–¥–µ—á–∫–æ —É–±–∏—Ä–∞–µ—Ç –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ. –î–∞–Ω–Ω—ã–µ: `GET /api/images/favorites`.

### –ù–∞ –¥–æ—Å–∫–µ (activeTab = 'board')
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ä–∞–∑–º–µ—â—ë–Ω–Ω—ã–µ –Ω–∞ —Ç–µ–∫—É—â–µ–π –¥–æ—Å–∫–µ (–∏–∑ `imagesStore.images`). –¢–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ (–±–µ–∑ –ø–∞–ø–æ–∫). –ö–ª–∏–∫ ‚Äî —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ viewport –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –Ω–∞ –¥–æ—Å–∫–µ. –î–∞–Ω–Ω—ã–µ: –ª–æ–∫–∞–ª—å–Ω—ã–µ, –Ω–µ —Ç—Ä–µ–±—É—é—Ç API.

### –§–æ–∫—É—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏
–ú–µ—Ö–∞–Ω–∏–∑–º –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–µ –Ω–∞ —Å—Ç–∏–∫–µ—Ä–∞—Ö:
1. `BoardImagesTab` –≤—ã–∑—ã–≤–∞–µ—Ç `imagesStore.requestFocusOnImage(imageId)`
2. `CanvasBoard.vue` watcher –Ω–∞ `imagesStore.pendingFocusImageId`
3. `useCanvasFocus.focusImageOnCanvas()` ‚Äî —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç viewport, –≤—ã–¥–µ–ª—è–µ—Ç, –∞–Ω–∏–º–∞—Ü–∏—è pulse
4. CSS-–∞–Ω–∏–º–∞—Ü–∏—è `.canvas-image--focused` –≤ `CanvasImage.vue`

## –õ–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
–ò–∑ —Ç–∞–±–ª–∏—Ü—ã subscription_plans (–ø–æ–ª–µ features):
- can_use_images ‚Äî –¥–æ—Å—Ç—É–ø –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ (boolean)
- image_library_max_files ‚Äî –º–∞–∫—Å–∏–º—É–º —Ñ–∞–π–ª–æ–≤ (-1 = –±–µ–∑–ª–∏–º–∏—Ç)
- image_library_max_folders ‚Äî –º–∞–∫—Å–∏–º—É–º –ø–∞–ø–æ–∫ (-1 = –±–µ–∑–ª–∏–º–∏—Ç)
- image_library_max_storage_mb ‚Äî –º–∞–∫—Å–∏–º—É–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ –ú–ë

## –¢–∞–±–ª–∏—Ü—ã –ë–î
- image_library ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ª–∏—á–Ω—ã–µ –∏ –æ–±—â–∏–µ)
- shared_folders ‚Äî –ø–∞–ø–∫–∏ –æ–±—â–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- image_favorites ‚Äî –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (user_id + image_id, UNIQUE)

## –í–∞–∂–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### Response schema –≤ Fastify 5
Response schema –≤ Fastify 5 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (`fast-json-stringify`),
–∞ –Ω–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –í—Å–µ –ø–æ–ª—è handler'–∞ –û–ë–Ø–ó–ê–ù–´ –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω—ã –≤ response schema ‚Äî –∏–Ω–∞—á–µ —É–¥–∞–ª—è—é—Ç—Å—è
- –¢–∏–ø—ã –û–ë–Ø–ó–ê–ù–´ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ‚Äî –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª–æ–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ handler ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å response schema

### Multipart-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤ Fastify 5
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `@fastify/multipart` –Ω–µ–ª—å–∑—è —É–∫–∞–∑—ã–≤–∞—Ç—å `body` –≤ schema.
Multipart-–¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `req.file()` –≤–Ω—É—Ç—Ä–∏ handler'–∞,
–∞ –Ω–µ —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é AJV-–≤–∞–ª–∏–¥–∞—Ü–∏—é. –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã —Å–ª–µ–¥—É–µ—Ç
—Ä–∞–∑–º–µ—â–∞—Ç—å –≤ –ø–æ–ª–µ `description` schema –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Swagger.
–≠—Ç–∞–ª–æ–Ω: –∑–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –≤ `api/routes/profile.js`.

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- 2026-02-07: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ schema –¥–ª—è POST /api/images/my/folders (folder_name –≤–º–µ—Å—Ç–æ name)
- 2026-02-07: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ response schema –¥–ª—è GET /api/images/shared (folders –≤–º–µ—Å—Ç–æ images)
- 2026-02-07: –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–∞–ø–∫–µ ("–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏")
- 2026-02-07: –£–¥–∞–ª—ë–Ω body schema –∏–∑ POST /api/images/upload (multipart –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å AJV-–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –≤ Fastify 5)
- 2026-02-07: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ response schema GET /api/images/my (items+pagination –≤–º–µ—Å—Ç–æ images+total)
- 2026-02-07: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ response schema GET /api/images/my/stats (usage+limits+planName)
- 2026-02-13: –î–æ–±–∞–≤–ª–µ–Ω—ã –≤–∫–ª–∞–¥–∫–∏ ¬´–ò–∑–±—Ä–∞–Ω–Ω–æ–µ¬ª –∏ ¬´–ù–∞ –¥–æ—Å–∫–µ¬ª –≤ –ø–∞–Ω–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- 2026-02-13: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ ¬´–ú–æ—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞¬ª ‚Üí ¬´–õ–∏—á–Ω—ã–µ¬ª
- 2026-02-13: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ image_favorites –∏ API –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- 2026-02-13: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞-—Å–µ—Ä–¥–µ—á–∫–æ (‚ô•) –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –õ–∏—á–Ω—ã–µ/–û–±—â–∞—è
- 2026-02-13: –í–∫–ª–∞–¥–∫–∞ ¬´–ù–∞ –¥–æ—Å–∫–µ¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –¥–æ—Å–∫–∏ —Å —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–ª–∏–∫—É
