# Telegram API Routes

–ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram (–ø—Ä–∏–≤—è–∑–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).

## –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ

`api/routes/telegram.js`

## Endpoints

### POST /api/user/telegram/generate-code

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ Telegram.

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–∞

**Response:**
```json
{
  "success": true,
  "code": "ABC123",
  "expiresAt": "2024-01-15T12:15:00.000Z",
  "botUsername": "fohow_bot"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 15 –º–∏–Ω—É—Ç.

---

### GET /api/user/telegram/check-link-status

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–∏–≤—è–∑–∫–∏ Telegram (polling).

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–∞

**Response (–ø—Ä–∏–≤—è–∑–∞–Ω):**
```json
{
  "success": true,
  "linked": true,
  "telegram": {
    "chat_id": "123456789",
    "username": "user_name"
  }
}
```

**Response (–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω):**
```json
{
  "success": true,
  "linked": false,
  "telegram": null
}
```

---

### POST /api/user/connect-telegram

–ü—Ä–∏–≤—è–∑–∫–∞ Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–æ—Ç–æ–º).

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–∞

**Body:**
```json
{
  "telegram_chat_id": "123456789",
  "telegram_username": "user_name"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Telegram —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –∞–∫–∫–∞—É–Ω—Ç—É",
  "telegram": {
    "chat_id": "123456789",
    "username": "user_name"
  }
}
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tribute:**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ webhook –æ—Ç Tribute
(`pending_tribute_webhooks`), –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É –¥–æ –ø—Ä–∏–≤—è–∑–∫–∏ Telegram.

---

### POST /api/user/telegram/unlink

–û—Ç–∫–ª—é—á–µ–Ω–∏–µ Telegram –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞.

**–¢—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** –î–∞

**Response:**
```json
{
  "success": true,
  "message": "Telegram —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω –æ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞"
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–æ—Å–ª–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram.

## –¢–∞–±–ª–∏—Ü—ã –ë–î

### telegram_link_codes

–•—Ä–∞–Ω–∏—Ç –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏:
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `code` - 6-—Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥
- `expires_at` - —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
- `used` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ –∫–æ–¥

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Tribute Payment

–ü—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ Telegram —á–µ—Ä–µ–∑ `/api/user/connect-telegram` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `processPendingTributeWebhooks(chatId)` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö webhook.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
1. –û–ø–ª–∞—Ç–∏–ª –ø–æ–¥–ø–∏—Å–∫—É —á–µ—Ä–µ–∑ Tribute –≤ Telegram
2. –ü–æ–ª—É—á–∏–ª webhook –æ—Ç Tribute (—Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ `pending_tribute_webhooks`)
3. –ó–∞—Ç–µ–º –ø—Ä–∏–≤—è–∑–∞–ª Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É –Ω–∞ —Å–∞–π—Ç–µ

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–µ

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –ø—Ä–∏–≤—è–∑–∫–µ Telegram –∫ –∞–∫–∫–∞—É–Ω—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å:
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø—Ä–∏–≤—è–∑–∫–∏
- Email –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- –°–ø–∏—Å–∫–æ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å
- **Inline-–∫–Ω–æ–ø–∫–∞:** "üë§ –í –ø—Ä–æ—Ñ–∏–ª—å" ‚Üí `https://interactive.marketingfohow.ru/`

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `api/bot/telegramBot.js` - Telegram –±–æ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥
- `api/services/processPendingTributeWebhooks.js` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö webhook
